classDiagram
    direction TB
    
    class ProtocolConnection {
        <<interface>>
        +isValid(): boolean
        +getConnectionId(): String
        +close(): void
    }

    class ProtocolExecutor {
        <<interface>>
        +executeCommand(CommandContext context): Object
    }

    class CommandContext {
        -connectionType: Class
        -protocolKey: String
        -commandExecutor: Function
        -retryAttempts: int
        -retryDelay: long
        +builder(): Builder
    }

    class ProtocolCommandService {
        -executor: ProtocolExecutor
        -poolManager: ProtocolConnectionPoolManager
        +executeCommand(CommandContext): Object
        +commandBuilder(): CommandContext.Builder
    }

    class ProtocolConnectionPoolManager {
        +borrowConnection(protocolKey): ProtocolConnection
        +returnConnection(protocolKey, connection): void
    }

    class ProtocolExecutionException {
        -protocolKey: String
        -failedAttempts: int
    }

    class ProtocolCommand {
        <<Annotation>>
        +value(): String
        +timeout(): long
        +retryAttempts(): int
        +retryDelay(): long
    }

    ProtocolCommandService "1" --> "1" ProtocolExecutor: uses
    ProtocolCommandService "1" --> "1" ProtocolConnectionPoolManager: manages
    ProtocolExecutor "1" --> "1" CommandContext: processes
    CommandContext "1" *-- "1" ProtocolConnection: requires
    ProtocolExecutor "1" --> "1" ProtocolExecutionException: throws
    
